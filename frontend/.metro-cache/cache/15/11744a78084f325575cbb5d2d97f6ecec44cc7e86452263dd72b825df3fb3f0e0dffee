{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"nrBDtkRVez7cBhLzyaRjl+xVfvE=","exportNames":["*"],"imports":1}},{"name":"expo-device","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":38,"index":91}}],"key":"bBpmAhO1g++sdeUzQmFVGoQIVwg=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/Platform","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dV3bI3NOD8bfMzaIniMaFGy/nn8=","exportNames":["*"],"imports":1}},{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":133},"end":{"line":4,"column":69,"index":202}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":203},"end":{"line":5,"column":26,"index":229}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.registerForPushNotifications = registerForPushNotifications;\n  exports.registerTokenWithServer = registerTokenWithServer;\n  exports.setupPushNotifications = setupPushNotifications;\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _expoNotifications = require(_dependencyMap[1], \"expo-notifications\");\n  var Notifications = _interopNamespace(_expoNotifications);\n  var _expoDevice = require(_dependencyMap[2], \"expo-device\");\n  var Device = _interopNamespace(_expoDevice);\n  var _reactNativeWebDistExportsPlatform = require(_dependencyMap[3], \"react-native-web/dist/exports/Platform\");\n  var Platform = _interopDefault(_reactNativeWebDistExportsPlatform);\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[4], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _axios = require(_dependencyMap[5], \"axios\");\n  var axios = _interopDefault(_axios);\n  const BACKEND_URL = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL;\n\n  /**\n   * Request notification permissions and get Expo push token\n   */\n  async function registerForPushNotifications() {\n    try {\n      // Check if we're on a physical device\n      if (!Device.isDevice) {\n        console.log('Push notifications require a physical device');\n        return null;\n      }\n\n      // Check existing permissions\n      const {\n        status: existingStatus\n      } = await Notifications.getPermissionsAsync();\n      let finalStatus = existingStatus;\n\n      // Request permissions if not already granted\n      if (existingStatus !== 'granted') {\n        const {\n          status\n        } = await Notifications.requestPermissionsAsync();\n        finalStatus = status;\n      }\n      if (finalStatus !== 'granted') {\n        console.log('Failed to get push notification permission');\n        return null;\n      }\n\n      // Get Expo push token\n      const tokenData = await Notifications.getExpoPushTokenAsync();\n      const token = tokenData.data;\n      console.log('Expo Push Token:', token);\n\n      // Configure Android notification channel\n      if (Platform.default.OS === 'android') {\n        await Notifications.setNotificationChannelAsync('default', {\n          name: 'SafeGuard Alerts',\n          importance: Notifications.AndroidImportance.MAX,\n          vibrationPattern: [0, 250, 250, 250],\n          lightColor: '#EF4444',\n          sound: 'default'\n        });\n        await Notifications.setNotificationChannelAsync('emergency', {\n          name: 'Emergency Alerts',\n          importance: Notifications.AndroidImportance.MAX,\n          vibrationPattern: [0, 500, 250, 500],\n          lightColor: '#FF0000',\n          sound: 'default',\n          bypassDnd: true\n        });\n      }\n      return token;\n    } catch (error) {\n      console.error('Error registering for push notifications:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Register push token with backend server\n   */\n  async function registerTokenWithServer(token) {\n    try {\n      const authToken = await AsyncStorage.default.getItem('auth_token');\n      if (!authToken) {\n        console.log('No auth token available to register push token');\n        return false;\n      }\n      await axios.default.post(`${BACKEND_URL}/api/push-token/register`, token, {\n        headers: {\n          Authorization: `Bearer ${authToken}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      await AsyncStorage.default.setItem('push_token', token);\n      console.log('Push token registered with server successfully');\n      return true;\n    } catch (error) {\n      console.error('Failed to register push token with server:', error.response?.data || error.message);\n      return false;\n    }\n  }\n\n  /**\n   * Full push notification setup - call after login\n   */\n  async function setupPushNotifications() {\n    const token = await registerForPushNotifications();\n    if (token) {\n      return await registerTokenWithServer(token);\n    }\n    return false;\n  }\n});","lineCount":137,"map":[[27,2,12,0,"exports"],[27,9,12,0],[27,10,12,0,"registerForPushNotifications"],[27,38,12,0],[27,41,12,0,"registerForPushNotifications"],[27,69,12,0],[28,2,71,0,"exports"],[28,9,71,0],[28,10,71,0,"registerTokenWithServer"],[28,33,71,0],[28,36,71,0,"registerTokenWithServer"],[28,59,71,0],[29,2,102,0,"exports"],[29,9,102,0],[29,10,102,0,"setupPushNotifications"],[29,32,102,0],[29,35,102,0,"setupPushNotifications"],[29,57,102,0],[30,2,110,1],[30,6,110,1,"_expoVirtualEnv"],[30,21,110,1],[30,24,110,1,"require"],[30,31,110,1],[30,32,110,1,"_dependencyMap"],[30,46,110,1],[31,2,1,0],[31,6,1,0,"_expoNotifications"],[31,24,1,0],[31,27,1,0,"require"],[31,34,1,0],[31,35,1,0,"_dependencyMap"],[31,49,1,0],[32,2,1,0],[32,6,1,0,"Notifications"],[32,19,1,0],[32,22,1,0,"_interopNamespace"],[32,39,1,0],[32,40,1,0,"_expoNotifications"],[32,58,1,0],[33,2,2,0],[33,6,2,0,"_expoDevice"],[33,17,2,0],[33,20,2,0,"require"],[33,27,2,0],[33,28,2,0,"_dependencyMap"],[33,42,2,0],[34,2,2,0],[34,6,2,0,"Device"],[34,12,2,0],[34,15,2,0,"_interopNamespace"],[34,32,2,0],[34,33,2,0,"_expoDevice"],[34,44,2,0],[35,2,2,38],[35,6,2,38,"_reactNativeWebDistExportsPlatform"],[35,40,2,38],[35,43,2,38,"require"],[35,50,2,38],[35,51,2,38,"_dependencyMap"],[35,65,2,38],[36,2,2,38],[36,6,2,38,"Platform"],[36,14,2,38],[36,17,2,38,"_interopDefault"],[36,32,2,38],[36,33,2,38,"_reactNativeWebDistExportsPlatform"],[36,67,2,38],[37,2,4,0],[37,6,4,0,"_reactNativeAsyncStorageAsyncStorage"],[37,42,4,0],[37,45,4,0,"require"],[37,52,4,0],[37,53,4,0,"_dependencyMap"],[37,67,4,0],[38,2,4,0],[38,6,4,0,"AsyncStorage"],[38,18,4,0],[38,21,4,0,"_interopDefault"],[38,36,4,0],[38,37,4,0,"_reactNativeAsyncStorageAsyncStorage"],[38,73,4,0],[39,2,5,0],[39,6,5,0,"_axios"],[39,12,5,0],[39,15,5,0,"require"],[39,22,5,0],[39,23,5,0,"_dependencyMap"],[39,37,5,0],[40,2,5,0],[40,6,5,0,"axios"],[40,11,5,0],[40,14,5,0,"_interopDefault"],[40,29,5,0],[40,30,5,0,"_axios"],[40,36,5,0],[41,2,7,0],[41,8,7,6,"BACKEND_URL"],[41,19,7,17],[41,22,7,17,"_expoVirtualEnv"],[41,37,7,17],[41,38,7,17,"env"],[41,41,7,17],[41,42,7,17,"EXPO_PUBLIC_BACKEND_URL"],[41,65,7,55],[43,2,9,0],[44,0,10,0],[45,0,11,0],[46,2,12,7],[46,17,12,22,"registerForPushNotifications"],[46,45,12,50,"registerForPushNotifications"],[46,46,12,50],[46,48,12,77],[47,4,13,2],[47,8,13,6],[48,6,14,4],[49,6,15,4],[49,10,15,8],[49,11,15,9,"Device"],[49,17,15,15],[49,18,15,16,"isDevice"],[49,26,15,24],[49,28,15,26],[50,8,16,6,"console"],[50,15,16,13],[50,16,16,14,"log"],[50,19,16,17],[50,20,16,18],[50,66,16,64],[50,67,16,65],[51,8,17,6],[51,15,17,13],[51,19,17,17],[52,6,18,4],[54,6,20,4],[55,6,21,4],[55,12,21,10],[56,8,21,12,"status"],[56,14,21,18],[56,16,21,20,"existingStatus"],[57,6,21,35],[57,7,21,36],[57,10,21,39],[57,16,21,45,"Notifications"],[57,29,21,58],[57,30,21,59,"getPermissionsAsync"],[57,49,21,78],[57,50,21,79],[57,51,21,80],[58,6,22,4],[58,10,22,8,"finalStatus"],[58,21,22,19],[58,24,22,22,"existingStatus"],[58,38,22,36],[60,6,24,4],[61,6,25,4],[61,10,25,8,"existingStatus"],[61,24,25,22],[61,29,25,27],[61,38,25,36],[61,40,25,38],[62,8,26,6],[62,14,26,12],[63,10,26,14,"status"],[64,8,26,21],[64,9,26,22],[64,12,26,25],[64,18,26,31,"Notifications"],[64,31,26,44],[64,32,26,45,"requestPermissionsAsync"],[64,55,26,68],[64,56,26,69],[64,57,26,70],[65,8,27,6,"finalStatus"],[65,19,27,17],[65,22,27,20,"status"],[65,28,27,26],[66,6,28,4],[67,6,30,4],[67,10,30,8,"finalStatus"],[67,21,30,19],[67,26,30,24],[67,35,30,33],[67,37,30,35],[68,8,31,6,"console"],[68,15,31,13],[68,16,31,14,"log"],[68,19,31,17],[68,20,31,18],[68,64,31,62],[68,65,31,63],[69,8,32,6],[69,15,32,13],[69,19,32,17],[70,6,33,4],[72,6,35,4],[73,6,36,4],[73,12,36,10,"tokenData"],[73,21,36,19],[73,24,36,22],[73,30,36,28,"Notifications"],[73,43,36,41],[73,44,36,42,"getExpoPushTokenAsync"],[73,65,36,63],[73,66,36,64],[73,67,36,65],[74,6,38,4],[74,12,38,10,"token"],[74,17,38,15],[74,20,38,18,"tokenData"],[74,29,38,27],[74,30,38,28,"data"],[74,34,38,32],[75,6,39,4,"console"],[75,13,39,11],[75,14,39,12,"log"],[75,17,39,15],[75,18,39,16],[75,36,39,34],[75,38,39,36,"token"],[75,43,39,41],[75,44,39,42],[77,6,41,4],[78,6,42,4],[78,10,42,8,"Platform"],[78,18,42,16],[78,19,42,16,"default"],[78,26,42,16],[78,27,42,17,"OS"],[78,29,42,19],[78,34,42,24],[78,43,42,33],[78,45,42,35],[79,8,43,6],[79,14,43,12,"Notifications"],[79,27,43,25],[79,28,43,26,"setNotificationChannelAsync"],[79,55,43,53],[79,56,43,54],[79,65,43,63],[79,67,43,65],[80,10,44,8,"name"],[80,14,44,12],[80,16,44,14],[80,34,44,32],[81,10,45,8,"importance"],[81,20,45,18],[81,22,45,20,"Notifications"],[81,35,45,33],[81,36,45,34,"AndroidImportance"],[81,53,45,51],[81,54,45,52,"MAX"],[81,57,45,55],[82,10,46,8,"vibrationPattern"],[82,26,46,24],[82,28,46,26],[82,29,46,27],[82,30,46,28],[82,32,46,30],[82,35,46,33],[82,37,46,35],[82,40,46,38],[82,42,46,40],[82,45,46,43],[82,46,46,44],[83,10,47,8,"lightColor"],[83,20,47,18],[83,22,47,20],[83,31,47,29],[84,10,48,8,"sound"],[84,15,48,13],[84,17,48,15],[85,8,49,6],[85,9,49,7],[85,10,49,8],[86,8,51,6],[86,14,51,12,"Notifications"],[86,27,51,25],[86,28,51,26,"setNotificationChannelAsync"],[86,55,51,53],[86,56,51,54],[86,67,51,65],[86,69,51,67],[87,10,52,8,"name"],[87,14,52,12],[87,16,52,14],[87,34,52,32],[88,10,53,8,"importance"],[88,20,53,18],[88,22,53,20,"Notifications"],[88,35,53,33],[88,36,53,34,"AndroidImportance"],[88,53,53,51],[88,54,53,52,"MAX"],[88,57,53,55],[89,10,54,8,"vibrationPattern"],[89,26,54,24],[89,28,54,26],[89,29,54,27],[89,30,54,28],[89,32,54,30],[89,35,54,33],[89,37,54,35],[89,40,54,38],[89,42,54,40],[89,45,54,43],[89,46,54,44],[90,10,55,8,"lightColor"],[90,20,55,18],[90,22,55,20],[90,31,55,29],[91,10,56,8,"sound"],[91,15,56,13],[91,17,56,15],[91,26,56,24],[92,10,57,8,"bypassDnd"],[92,19,57,17],[92,21,57,19],[93,8,58,6],[93,9,58,7],[93,10,58,8],[94,6,59,4],[95,6,61,4],[95,13,61,11,"token"],[95,18,61,16],[96,4,62,2],[96,5,62,3],[96,6,62,4],[96,13,62,11,"error"],[96,18,62,16],[96,20,62,18],[97,6,63,4,"console"],[97,13,63,11],[97,14,63,12,"error"],[97,19,63,17],[97,20,63,18],[97,63,63,61],[97,65,63,63,"error"],[97,70,63,68],[97,71,63,69],[98,6,64,4],[98,13,64,11],[98,17,64,15],[99,4,65,2],[100,2,66,0],[102,2,68,0],[103,0,69,0],[104,0,70,0],[105,2,71,7],[105,17,71,22,"registerTokenWithServer"],[105,40,71,45,"registerTokenWithServer"],[105,41,71,46,"token"],[105,46,71,59],[105,48,71,79],[106,4,72,2],[106,8,72,6],[107,6,73,4],[107,12,73,10,"authToken"],[107,21,73,19],[107,24,73,22],[107,30,73,28,"AsyncStorage"],[107,42,73,40],[107,43,73,40,"default"],[107,50,73,40],[107,51,73,41,"getItem"],[107,58,73,48],[107,59,73,49],[107,71,73,61],[107,72,73,62],[108,6,74,4],[108,10,74,8],[108,11,74,9,"authToken"],[108,20,74,18],[108,22,74,20],[109,8,75,6,"console"],[109,15,75,13],[109,16,75,14,"log"],[109,19,75,17],[109,20,75,18],[109,68,75,66],[109,69,75,67],[110,8,76,6],[110,15,76,13],[110,20,76,18],[111,6,77,4],[112,6,79,4],[112,12,79,10,"axios"],[112,17,79,15],[112,18,79,15,"default"],[112,25,79,15],[112,26,79,16,"post"],[112,30,79,20],[112,31,80,6],[112,34,80,9,"BACKEND_URL"],[112,45,80,20],[112,71,80,46],[112,73,81,6,"token"],[112,78,81,11],[112,80,82,6],[113,8,83,8,"headers"],[113,15,83,15],[113,17,83,17],[114,10,84,10,"Authorization"],[114,23,84,23],[114,25,84,25],[114,35,84,35,"authToken"],[114,44,84,44],[114,46,84,46],[115,10,85,10],[115,24,85,24],[115,26,85,26],[116,8,86,8],[117,6,87,6],[117,7,88,4],[117,8,88,5],[118,6,90,4],[118,12,90,10,"AsyncStorage"],[118,24,90,22],[118,25,90,22,"default"],[118,32,90,22],[118,33,90,23,"setItem"],[118,40,90,30],[118,41,90,31],[118,53,90,43],[118,55,90,45,"token"],[118,60,90,50],[118,61,90,51],[119,6,91,4,"console"],[119,13,91,11],[119,14,91,12,"log"],[119,17,91,15],[119,18,91,16],[119,66,91,64],[119,67,91,65],[120,6,92,4],[120,13,92,11],[120,17,92,15],[121,4,93,2],[121,5,93,3],[121,6,93,4],[121,13,93,11,"error"],[121,18,93,21],[121,20,93,23],[122,6,94,4,"console"],[122,13,94,11],[122,14,94,12,"error"],[122,19,94,17],[122,20,94,18],[122,64,94,62],[122,66,94,64,"error"],[122,71,94,69],[122,72,94,70,"response"],[122,80,94,78],[122,82,94,80,"data"],[122,86,94,84],[122,90,94,88,"error"],[122,95,94,93],[122,96,94,94,"message"],[122,103,94,101],[122,104,94,102],[123,6,95,4],[123,13,95,11],[123,18,95,16],[124,4,96,2],[125,2,97,0],[127,2,99,0],[128,0,100,0],[129,0,101,0],[130,2,102,7],[130,17,102,22,"setupPushNotifications"],[130,39,102,44,"setupPushNotifications"],[130,40,102,44],[130,42,102,65],[131,4,103,2],[131,10,103,8,"token"],[131,15,103,13],[131,18,103,16],[131,24,103,22,"registerForPushNotifications"],[131,52,103,50],[131,53,103,51],[131,54,103,52],[132,4,105,2],[132,8,105,6,"token"],[132,13,105,11],[132,15,105,13],[133,6,106,4],[133,13,106,11],[133,19,106,17,"registerTokenWithServer"],[133,42,106,40],[133,43,106,41,"token"],[133,48,106,46],[133,49,106,47],[134,4,107,2],[135,4,109,2],[135,11,109,9],[135,16,109,14],[136,2,110,0],[137,0,110,1],[137,3]],"functionMap":{"names":["<global>","registerForPushNotifications","registerTokenWithServer","setupPushNotifications"],"mappings":"AAA;OCW;CDsD;OEK;CF0B;OGK;CHQ"},"hasCjsExports":false},"type":"js/module"}]}